condition status change reason message 
1. FirmwareUpdating false -> true FirmwareUpdateStart upgrading sw-0 firmware to 10.13.1110 
2. SwitchOffline false -> true OfflineSwitch silencing switch alerts during firmware update 
3. FirewareUploading false -> true FirmwareUploadStart updloading firmware to switch 
4. FirewareUploading true -> false FirmwareUploadFinished upload complete 
5. SwitchRebooting false -> true RebootingSwitch rebooting 
6. SwitchRebooting true -> false SwitchRebooted reboot complete 
7. SwitchOffline true -> false OnlineSwitch enabling switch alerts and events 
8. FirmwareUpdating true -> false FirmwareUpdateComplete firmware update to 10.13.1110 complete

APIs:
- SetOfflineRequest
- UploadFirmwareRequest
- RebootSwitchRequest

Reconcile Loop Steps:

Questions:
- How do we know each step is complete?

Notes: 
- Clean up state machine

207587

```
	// Get all conditions related to switch firmware update
	fwUpdateConditions := getFwUpdateConditions(hfSwitch)

	// Step 1: Initiate firmware update
	// Set overall condition and make a request to put the switch in offline mode
	if fwUpdateConditions[v1.ConditionFirmwareUpdating].Status == v1.ConditionStatusFalse {
		// Log that the firmware update process has been initiated
		log.Infof(
			"Queuing switch %d firmware update to version to '%s'",
			matchingSwitch.GetId(),
			*hfSwitch.Spec.FirmwareVersion,
		)

		// Set switch firmware update condition and set ready condition
		err := hfutils.UpdateObjStateConditions(
			ctx,
			&hfSwitch.Status.Conditions,
			hfutils.FirmwareUpdating,
			hfSwitch.Generation,
			nil,
		)
		err = client.Status().Patch(ctx, hfSwitch, cli.Merge)
		if err != nil {
			log.Errorf("Failed to set switch firmware update condition: %v", err)
			return err
		}

		// Make the SetOfflineRequest API call to put the switch into offline mode
		// Sleep to simulate the delay of the request
		log.Infof("Offlining switch %d for firmware update", matchingSwitch.GetId())
		time.Sleep(time.Duration(10))

		// Set switch offline condition
		err = hfutils.UpdateObjStateConditions(
			ctx,
			&hfSwitch.Status.Conditions,
			hfutils.SwitchOffline,
			hfSwitch.Generation,
			nil,
		)
		err = client.Status().Patch(ctx, hfSwitch, cli.Merge)
		if err != nil {
			log.Errorf("Failed to set switch offline condition: %v", err)
			return err
		}
		return nil

	} else {
		if matchingSwitch.GetOverallStatus() == pbsvc.SwitchStatus_OFFLINE_MODE &&
			fwUpdateConditions[v1.ConditionFirmwareUploading].Status == v1.ConditionStatusFalse {
			// Step 2: Begin uploading firmware if the switch reports it is offline and upload condition isn't set

			// Make the UploadFirmwareRequest API call to begin uploading the firmware image to the switch
			// Sleep to simulate the delay of the request
			log.Infof("Uploading firmware to switch %d", matchingSwitch.GetId())
			time.Sleep(time.Duration(10))

			// We will eventually replace this as switchd is going to update the list switches
			// API to include a field which indicates if the firmware has been uploaded
			go func() {
				time.Sleep(time.Duration(30))
				firmwareUploaded = true
			}()

			// Set firmware uploading condition
			err := hfutils.UpdateObjStateConditions(
				ctx,
				&hfSwitch.Status.Conditions,
				hfutils.FirmwareUploading,
				hfSwitch.Generation,
				nil,
			)
			err = client.Status().Patch(ctx, hfSwitch, cli.Merge)
			if err != nil {
				log.Errorf("Failed to set switch firmware uploading condition: %v", err)
				return err
			}
			return nil

		} else if matchingSwitch.GetOverallStatus() == pbsvc.SwitchStatus_OFFLINE_MODE && firmwareUploaded {
			// Step 3: Reboot into inactive partition if the switch is in offline mode and firmware image has been uploaded

			// Reset firmware uploaded variable for future updates
			// Remove once switchd provides this information in list switches
			firmwareUploaded = false

			// Unset uploading condition
			err := hfutils.UpdateObjStateConditions(
				ctx,
				&hfSwitch.Status.Conditions,
				hfutils.FirmwareUploaded,
				hfSwitch.Generation,
				nil,
			)
			err = client.Status().Patch(ctx, hfSwitch, cli.Merge)
			if err != nil {
				log.Errorf("Failed to unset switch firmware uploading condition: %v", err)
				return err
			}

			// Make the RebootSwitchRequest API call to boot into the inactive partition of the switch
			// Sleep to simulate the delay of the request
			log.Infof("Rebooting switch %d", matchingSwitch.GetId())
			time.Sleep(time.Duration(10))

			// Set rebooting condition
			err = hfutils.UpdateObjStateConditions(
				ctx,
				&hfSwitch.Status.Conditions,
				hfutils.SwitchRebooting,
				hfSwitch.Generation,
				nil,
			)
			err = client.Status().Patch(ctx, hfSwitch, cli.Merge)
			if err != nil {
				log.Errorf("Failed to set switch reboot condition: %v", err)
				return err
			}
			return nil

		} else if matchingSwitch.GetOverallStatus() == pbsvc.SwitchStatus_OFFLINE_MODE &&
			matchingSwitch.GetFwVersion() == *hfSwitch.Spec.FirmwareVersion {
			// Step 4: Bring the switch back online and begin clearing conditions if the switch has rebooted and is reporting the updated firmware version

			// Unset rebooting condition
			err := hfutils.UpdateObjStateConditions(
				ctx,
				&hfSwitch.Status.Conditions,
				hfutils.SwitchRebooted,
				hfSwitch.Generation,
				nil,
			)
			err = client.Status().Patch(ctx, hfSwitch, cli.Merge)
			if err != nil {
				log.Errorf("Failed to unset switch reboot condition: %v", err)
				return err
			}

			// Make the SetOfflineRequest API call to bring the switch back online
			// Sleep to simulate the delay of the request
			log.Infof("Onlining switch %d after firmware update", matchingSwitch.GetId())
			time.Sleep(time.Duration(10))

			return nil

		} else if matchingSwitch.GetOverallStatus() == pbsvc.SwitchStatus_GOOD &&
			matchingSwitch.GetFwVersion() == *hfSwitch.Spec.FirmwareVersion {
			// Step 5: Clean up the remaining firmware update related conditions to complete the process

			// Unset switch offline condition, unset switch firmware update condition, and set switch ready condition
			err := hfutils.UpdateObjStateConditions(
				ctx,
				&hfSwitch.Status.Conditions,
				hfutils.FirmwareUpdated,
				hfSwitch.Generation,
				nil,
			)
			err = client.Status().Patch(ctx, hfSwitch, cli.Merge)
			if err != nil {
				log.Errorf("Failed to unset switch firmware update condition: %v", err)
				return err
			}
			return nil

		} else {
			errMessage := fmt.Sprintf("Switch firmware update state unknown: %v", fwUpdateConditions)
			log.Error(errMessage)
			return fmt.Errorf(errMessage)
		}
	}

```